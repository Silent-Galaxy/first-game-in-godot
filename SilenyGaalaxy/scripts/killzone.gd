extends Area2D

# دسترسی به نود تایمر برای ایجاد وقفه قبل از ریست شدن بازی
@onready var timer = $Timer

# این تابع زمانی اجرا می‌شود که یک جسم فیزیکی (مثل بازیکن) وارد منطقه مرگ شود
# سیگنال: body_entered
func _on_body_entered(body):
	# 1. چاپ پیام در کنسول برای دیباگ
	print("You died!")
	
	# 2. ایجاد افکت اسلوموشن (Slow Motion)
	# عدد 0.5 یعنی سرعت بازی نصف می‌شود. این کار به مرگ بازیکن وزن و حس می‌دهد.
	Engine.time_scale = 0.5
	
	# 3. حذف کالیژن بازیکن
	# با حذف CollisionShape2D، بازیکن دیگر روی زمین نمی‌ایستد و
	# از داخل زمین به پایین سقوط می‌کند (یک افکت مرگ کلاسیک).
	# نکته: نام نود کالیژن در صحنه پلیر باید دقیقاً "CollisionShape2D" باشد.
	body.get_node("CollisionShape2D").queue_free()
	
	# 4. شروع تایمر
	# صبر می‌کنیم تا انیمیشن سقوط تمام شود، سپس بازی را ریست می‌کنیم.
	timer.start()


# این تابع زمانی اجرا می‌شود که زمان تایمر تمام شود
# سیگنال: timeout
func _on_timer_timeout():
	# 1. برگرداندن سرعت بازی به حالت عادی
	# خیلی مهم است! اگر این کار را نکنیم، بازی بعد از ریست شدن هم اسلوموشن می‌ماند.
	Engine.time_scale = 1.0
	
	# 2. بارگذاری مجدد صحنه فعلی (Restart Level)
	get_tree().reload_current_scene()
